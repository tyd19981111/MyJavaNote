# JdbcTemplate

### æ¦‚å¿µå’Œå‡†å¤‡

- ä»€ä¹ˆæ˜¯ JdbcTemplate
    - Spring æ¡†æ¶å¯¹ JDBC è¿›è¡Œå°è£…ï¼Œä½¿ç”¨ JdbcTemplate æ–¹ä¾¿å®ç°å¯¹æ•°æ®åº“æ“ä½œ
- å‡†å¤‡å·¥ä½œ
    - å¼•å…¥ç›¸å…³ jar åŒ…
        
        ![jdbc](./images/jdbc.png)
        
    - åœ¨ spring é…ç½®æ–‡ä»¶é…ç½®[æ•°æ®åº“è¿æ¥æ± ](https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0&spm=1001.2101.3001.7020)
        
        ```xml
        <bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" destroy-method="close">
         <property name="url" value="jdbc:mysql:///test" />
         <property name="username" value="root" />
         <property name="password" value="root" />
         <property name="driverClassName" value="com.mysql.jdbc.Driver" />
        </bean>
        ```
        
    - é…ç½® JdbcTemplate å¯¹è±¡ï¼Œæ³¨å…¥ DataSource
        
        ```xml
        <!-- JdbcTemplate å¯¹è±¡ -->
        <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
         <!--æ³¨å…¥ dataSource-->
         <property name="dataSource" ref="dataSource"></property><!--setæ–¹å¼æ³¨å…¥-->
        </bean>
        ```
        
    - åˆ›å»º service ç±»ï¼Œåˆ›å»º dao ç±»ï¼Œåœ¨ dao æ³¨å…¥ jdbcTemplate å¯¹è±¡
        - é…ç½®æ–‡ä»¶
            
            ```xml
            <!-- ç»„ä»¶æ‰«æ -->
            <context:component-scan base-package="com.atguigu"></context:component-scan>
            ```
            
        - Serviceç±»ä¸­æ³¨å…¥Dao
            
            ```java
            @Service
            public class BookService {
             //æ³¨å…¥ dao
             @Autowired
             private BookDao bookDao;
            }
            ```
            
        - dao æ³¨å…¥ jdbcTemplate å¯¹è±¡
            
            ```java
            @Repository
            public class BookDaoImpl implements BookDao {
             //æ³¨å…¥ JdbcTemplate
             @Autowired
             private JdbcTemplate jdbcTemplate;
            }
            ```
            

### JdbcTemplate æ“ä½œæ•°æ®åº“ï¼ˆæ·»åŠ ï¼‰

- å¯¹åº”æ•°æ®åº“åˆ›å»ºå®ä½“ç±»
    
    ```java
    public class User {
    	private String userId;
    	private String username;
    	private String userstatus;
    	//ç”Ÿæˆå¯¹åº”çš„getã€setæ–¹æ³•
    }
    ```
    
- ç¼–å†™ service å’Œ dao
    - åœ¨ dao è¿›è¡Œæ•°æ®åº“æ·»åŠ æ“ä½œ
    - è°ƒç”¨ JdbcTemplate å¯¹è±¡é‡Œé¢ update æ–¹æ³•å®ç°æ·»åŠ æ“ä½œ
        
        <aside>
        ğŸ“¢ `update(String sql,Object... args)`
        
        ç¬¬ä¸€ä¸ªå‚æ•°ï¼š sql è¯­å¥
        
        ç¬¬äºŒä¸ªå‚æ•°ï¼šå¯å˜å‚æ•°ï¼Œè®¾ç½® sql è¯­å¥å€¼
        
        è¿”å›å€¼ä¸ºæ›´æ–°çš„è¡Œæ•°
        
        </aside>
        
        ```java
        @Repository
        public class BookDaoImpl implements BookDao {
         //æ³¨å…¥ JdbcTemplate
         @Autowired
         private JdbcTemplate jdbcTemplate;
         //æ·»åŠ çš„æ–¹æ³•
         @Override
         public void add(Book book) {
         //1 åˆ›å»º sql è¯­å¥
         String sql = "insert into t_book values(?,?,?)";
         //2 è°ƒç”¨æ–¹æ³•å®ç°
         Object[] args = {book.getUserId(), book.getUsername(),book.getUstatus()};
         int update = jdbcTemplate.update(sql,args);
         System.out.println(update);
         }
        }
        ```
        
    - æµ‹è¯•ç±»
        
        ```java
        @Test
        public void testJdbcTemplate() {
        	ApplicationContext context = new ClassPathXmlApplicationContext("bean1.xml");
        	BookService bookService = context.getBean("bookService",BookService.class);
        	Book book = new Book();
        	book.setUserId("1");
        	book.setUsername("java");
        	book.setUstatus("a");
        	bookService.addBook(book);
        }
        ```
        

### JdbcTemplate æ“ä½œæ•°æ®åº“ï¼ˆä¿®æ”¹å’Œåˆ é™¤ï¼‰

- ä¿®æ”¹
    
    ```java
    @Override
    public void updateBook(Book book) {
     String sql = "update t_book set username=?,ustatus=? where user_id=?";
     Object[] args = {book.getUsername(), book.getUstatus(),book.getUserId()};
     int update = jdbcTemplate.update(sql, args);
     System.out.println(update);
    }
    ```
    
- åˆ é™¤
    
    ```java
    @Override
    public void delete(String id) {
     String sql = "delete from t_book where user_id=?";
     int update = jdbcTemplate.update(sql, id);
     System.out.println(update);
    }
    ```
    

<aside>
ğŸ“¢ ä½¿ç”¨JdbcTemplate æ¨¡æ¿æ‰€å®ç°çš„ â€œå¢åˆ æ”¹â€ éƒ½æ˜¯è°ƒç”¨äº†åŒä¸€ä¸ª â€œupdateâ€ æ–¹æ³•

</aside>

### JdbcTemplate æ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›æŸä¸ªå€¼ï¼‰

- æŸ¥è¯¢è¡¨é‡Œé¢æœ‰å¤šå°‘æ¡è®°å½•ï¼Œè¿”å›æ˜¯æŸä¸ªå€¼
- ä½¿ç”¨ JdbcTemplate å®ç°æŸ¥è¯¢è¿”å›æŸä¸ªå€¼
    - æ–¹æ³•ï¼š`queryForObject(String sql,Class<T> requiredType)`
        - ç¬¬ä¸€ä¸ªå‚æ•°ï¼š sql è¯­å¥
        - ç¬¬äºŒä¸ªå‚æ•°ï¼šè¿”å›ç±»å‹ Class
    
    ```java
    //æŸ¥è¯¢è¡¨è®°å½•æ•°
    @Override
    public int selectCount() {
    	 String sql = "select count(*) from t_book";
    	 Integer count = jdbcTemplate.queryForObject(sql, Integer.class);
    	 return count;
    }
    ```
    

### JdbcTemplate æ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›å¯¹è±¡ï¼‰

- åœºæ™¯ï¼šæŸ¥è¯¢å›¾ä¹¦è¯¦æƒ…
- JdbcTemplate å®ç°æŸ¥è¯¢è¿”å›å¯¹è±¡
    - æ–¹æ³•ï¼š`queryForObject(String sql,RowMapper<T> rowMapper,Object... args)`
        - ç¬¬ä¸€ä¸ªå‚æ•°ï¼š sql è¯­å¥
        - ç¬¬äºŒä¸ªå‚æ•°ï¼šRowMapper æ˜¯æ¥å£ï¼Œé’ˆå¯¹è¿”å›ä¸åŒç±»å‹æ•°æ®ï¼Œä½¿ç”¨è¿™ä¸ªæ¥å£é‡Œé¢å®ç°ç±»å®Œæˆæ•°æ®å°è£…
        - *ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šsql è¯­å¥å€¼*
    
    ```java
    //æŸ¥è¯¢è¿”å›å¯¹è±¡
    @Override
    public Book findBookInfo(String id) {
     String sql = "select * from t_book where user_id=?";
    //è°ƒç”¨æ–¹æ³•
     Book book = jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper<Book>(Book.class), id);
     return book;
    }
    ```
    

### JdbcTemplate æ“ä½œæ•°æ®åº“ï¼ˆæŸ¥è¯¢è¿”å›é›†åˆï¼‰

- åœºæ™¯ï¼šæŸ¥è¯¢å›¾ä¹¦åˆ—è¡¨åˆ†é¡µ
- è°ƒç”¨ JdbcTemplate æ–¹æ³•å®ç°æŸ¥è¯¢è¿”å›é›†åˆ
    - æ–¹æ³•ï¼š`query(String sql,RowMapper<T> rowMapper,Object... args)`
    
    ```java
    //æŸ¥è¯¢è¿”å›é›†åˆ
    @Override
    public List<Book> findAllBook() {
     String sql = "select * from t_book";
     //è°ƒç”¨æ–¹æ³•
     List<Book> bookList = jdbcTemplate.query(sql, new BeanPropertyRowMapper<Book>(Book.class));
     return bookList;
    }
    ```
    

### JdbcTemplate æ“ä½œæ•°æ®åº“ï¼ˆæ‰¹é‡æ“ä½œï¼‰

- æ–¹æ³•ï¼š`batchUpdate(String sql, List<Object[]> batchArgs)`
    - ç¬¬ä¸€ä¸ªå‚æ•°ï¼š sql è¯­å¥
    - ç¬¬äºŒä¸ªå‚æ•°ï¼š List é›†åˆï¼Œæ·»åŠ å¤šæ¡è®°å½•æ•°æ®
- æ‰¹é‡æ·»åŠ 
    
    ```java
    @Override
    public void batchAddBook(List<Object[]> batchArgs) {
    	String sql = "insert into t_book values(?,?,?)";
    	int[] ints = jdbcTemplate.batchUpdate(sql, batchArgs);
    	System.out.println(Arrays.toString(ints));
    }
    //æ‰¹é‡æ·»åŠ æµ‹è¯•
    List<Object[]> batchArgs = new ArrayList<>();
    Object[] o1 = {"3","java","a"};
    Object[] o2 = {"4","c++","b"};
    Object[] o3 = {"5","MySQL","c"};
    batchArgs.add(o1);
    batchArgs.add(o2);
    batchArgs.add(o3);
    //è°ƒç”¨æ‰¹é‡æ·»åŠ 
    bookService.batchAdd(batchArgs);
    ```
    

- æ‰¹é‡ä¿®æ”¹
    
    ```java
    @Override
    public void batchUpdateBook(List<Object[]> batchArgs) {
    	String sql = "update t_book set username=?,ustatus=? where user_id=?";
    	int[] ints = jdbcTemplate.batchUpdate(sql, batchArgs);
    	System.out.println(Arrays.toString(ints));
    }
    //æ‰¹é‡ä¿®æ”¹
    List<Object[]> batchArgs = new ArrayList<>();
    Object[] o1 = {"java0909","a3","3"};
    Object[] o2 = {"c++1010","b4","4"};
    Object[] o3 = {"MySQL1111","c5","5"};
    batchArgs.add(o1);
    batchArgs.add(o2);
    batchArgs.add(o3);
    //è°ƒç”¨æ–¹æ³•å®ç°æ‰¹é‡ä¿®æ”¹
    bookService.batchUpdate(batchArgs);
    ```
    
- æ‰¹é‡åˆ é™¤
    
    ```java
    @Override
    public void batchDeleteBook(List<Object[]> batchArgs) {
    	String sql = "delete from t_book where user_id=?";
    	int[] ints = jdbcTemplate.batchUpdate(sql, batchArgs);
    	System.out.println(Arrays.toString(ints));
    }
    //æ‰¹é‡åˆ é™¤
    List<Object[]> batchArgs = new ArrayList<>();
    Object[] o1 = {"3"};
    Object[] o2 = {"4"};
    batchArgs.add(o1);
    batchArgs.add(o2);
    //è°ƒç”¨æ–¹æ³•å®ç°æ‰¹é‡åˆ é™¤
    bookService.batchDelete(batchArgs);
    ```