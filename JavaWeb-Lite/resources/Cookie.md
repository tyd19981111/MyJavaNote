# Cookie

# 1. ****ä¼šè¯è·Ÿè¸ªæŠ€æœ¯çš„æ¦‚è¿°****

### 1.1 ä¼šè¯

- ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®webæœåŠ¡å™¨çš„èµ„æºï¼Œä¼šè¯å»ºç«‹ï¼Œç›´åˆ°æœ‰ä¸€æ–¹æ–­å¼€è¿æ¥ï¼Œä¼šè¯ç»“æŸã€‚
- åœ¨ä¸€æ¬¡ä¼šè¯ä¸­å¯ä»¥åŒ…å«å¤šæ¬¡è¯·æ±‚å’Œå“åº”

### 1.2 ä¼šè¯è·Ÿè¸ª

- ä¸€ç§ç»´æŠ¤æµè§ˆå™¨çŠ¶æ€çš„æ–¹æ³•ï¼ŒæœåŠ¡å™¨éœ€è¦è¯†åˆ«å¤šæ¬¡è¯·æ±‚æ˜¯å¦æ¥è‡ªäºåŒä¸€æµè§ˆå™¨
- æœåŠ¡å™¨è¯†åˆ«æµè§ˆå™¨åå°±å¯ä»¥åœ¨åŒä¸€ä¸ªä¼šè¯ä¸­å¤šæ¬¡è¯·æ±‚ä¹‹é—´æ¥å…±äº«æ•°æ®
- åº”ç”¨åœºæ™¯
    - è´­ç‰©è½¦ï¼š`åŠ å…¥è´­ç‰©è½¦`å’Œ`å»è´­ç‰©è½¦ç»“ç®—`æ˜¯ä¸¤æ¬¡è¯·æ±‚ï¼Œä½†æ˜¯åé¢è¿™æ¬¡è¯·æ±‚è¦æƒ³å±•ç¤ºå‰ä¸€æ¬¡è¯·æ±‚æ‰€æ·»åŠ çš„å•†å“ï¼Œå°±éœ€è¦ç”¨åˆ°æ•°æ®å…±äº«
    - é¡µé¢å±•ç¤ºç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼šå¾ˆå¤šç½‘ç«™ï¼Œç™»å½•åè®¿é—®å…¶ä»–åŠŸèƒ½å‘é€è¯·æ±‚åï¼Œæµè§ˆå™¨ä¸Šéƒ½ä¼šæœ‰å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯[ç”¨æˆ·å]
    - ç½‘ç«™ç™»å½•é¡µé¢çš„`è®°ä½æˆ‘`åŠŸèƒ½ï¼šå½“ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå‹¾é€‰`è®°ä½æˆ‘`æŒ‰é’®åä¸‹æ¬¡å†ç™»å½•çš„æ—¶å€™ï¼Œç½‘ç«™å°±ä¼šè‡ªåŠ¨å¡«å……ç”¨æˆ·åå’Œå¯†ç ï¼Œç®€åŒ–ç”¨æˆ·çš„ç™»å½•æ“ä½œ
- å®ç°æ–¹å¼
    - å®¢æˆ·ç«¯ä¼šè¯è·Ÿè¸ªæŠ€æœ¯ï¼š**Cookie**
    - æœåŠ¡ç«¯ä¼šè¯è·Ÿè¸ªæŠ€æœ¯ï¼š**Session**
    
    <aside>
    ğŸ’¡ è¿™ä¸¤ä¸ªæŠ€æœ¯éƒ½å¯ä»¥å®ç°ä¼šè¯è·Ÿè¸ªï¼Œå®ƒä»¬ä¹‹é—´æœ€å¤§çš„åŒºåˆ«ï¼šCookieæ˜¯å­˜å‚¨åœ¨æµè§ˆå™¨ç«¯è€ŒSessionæ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯
    
    </aside>
    
    <aside>
    â“ Httpä¸ºä»€ä¹ˆä¸èƒ½å®ç°è¯·æ±‚é—´æ•°æ®å…±äº«ï¼ŸHTTPåè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œæ¯æ¬¡æµè§ˆå™¨å‘æœåŠ¡å™¨è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨éƒ½ä¼šå°†è¯¥è¯·æ±‚è§†ä¸ºæ–°çš„è¯·æ±‚ï¼Œæ¯æ¬¡è¯·æ±‚ä¹‹é—´ç›¸äº’ç‹¬ç«‹
    
    </aside>
    

# 2. ****Cookie****

### 2.1 Cookieå·¥ä½œæµç¨‹

- Cookieï¼šå®¢æˆ·ç«¯ä¼šè¯æŠ€æœ¯ï¼Œå°†æ•°æ®ä¿å­˜åˆ°å®¢æˆ·ç«¯ï¼Œä»¥åæ¯æ¬¡è¯·æ±‚éƒ½æºå¸¦Cookieæ•°æ®è¿›è¡Œè®¿é—®
- Cookieçš„å·¥ä½œæµç¨‹
    
    ![Untitled](Cookie%20849cd773d5294afe9832d86d42307bca/Untitled.png)
    
    - æœåŠ¡ç«¯æä¾›äº†ä¸¤ä¸ªServletï¼Œåˆ†åˆ«æ˜¯ServletAå’ŒServletB
    - æµè§ˆå™¨å‘é€HTTPè¯·æ±‚1ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ServletAæ¥æ”¶è¯·æ±‚å¹¶è¿›è¡Œä¸šåŠ¡å¤„ç†
    - æœåŠ¡ç«¯ServletAåœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­å¯ä»¥åˆ›å»ºä¸€ä¸ªCookieå¯¹è±¡å¹¶å°†`name=zs`çš„æ•°æ®å­˜å…¥Cookie
    - æœåŠ¡ç«¯ServletAåœ¨å“åº”æ•°æ®çš„æ—¶å€™ï¼Œä¼šæŠŠCookieå¯¹è±¡å“åº”ç»™æµè§ˆå™¨
    - æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”æ•°æ®ï¼Œä¼šæŠŠCookieå¯¹è±¡ä¸­çš„æ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨å†…å­˜ä¸­ï¼Œæ­¤æ—¶æµè§ˆå™¨å’ŒæœåŠ¡ç«¯å°±==å»ºç«‹äº†ä¸€æ¬¡ä¼šè¯==
    - åœ¨åŒä¸€æ¬¡ä¼šè¯ä¸­æµè§ˆå™¨å†æ¬¡å‘é€HTTPè¯·æ±‚2ç»™æœåŠ¡ç«¯ServletBï¼Œæµè§ˆå™¨ä¼šæºå¸¦Cookieå¯¹è±¡ä¸­çš„æ‰€æœ‰æ•°æ®
    - ServletBæ¥æ”¶åˆ°è¯·æ±‚å’Œæ•°æ®åï¼Œå°±å¯ä»¥è·å–åˆ°å­˜å‚¨åœ¨Cookieå¯¹è±¡ä¸­çš„æ•°æ®ï¼Œè¿™æ ·åŒä¸€ä¸ªä¼šè¯ä¸­çš„å¤šæ¬¡è¯·æ±‚ä¹‹é—´å°±å®ç°äº†æ•°æ®å…±äº«

### 2.2 CookieåŸºæœ¬ä½¿ç”¨

- å‘é€Cookie
    - åˆ›å»ºCookieå¯¹è±¡ï¼Œå¹¶è®¾ç½®æ•°æ®
        
        `Cookie cookie = new Cookie("key","value");`
        
    - å‘é€Cookieåˆ°å®¢æˆ·ç«¯ï¼šä½¿ç”¨==response==å¯¹è±¡
        
        `response.addCookie(cookie);`
        
- è·å–Cookie
    - è·å–å®¢æˆ·ç«¯æºå¸¦çš„æ‰€æœ‰Cookieï¼Œä½¿ç”¨requestå¯¹è±¡
        
        `Cookie[] cookies = request.getCookies();`
        
    - ä½¿ç”¨Cookieå¯¹è±¡æ–¹æ³•è·å–æ•°æ®
        
        `cookie.getName();
        cookie.getValue();`
        
- æ¡ˆä¾‹æ¼”ç¤º
    - åˆ›å»ºMavené¡¹ç›®cookie-demoï¼Œå¹¶åœ¨pom.xmlæ·»åŠ ä¾èµ–
        
        ```xml
        <dependencies>
            <!--servlet-->
            <dependency>
                <groupId>javax.servlet</groupId>
                <artifactId>javax.servlet-api</artifactId>
                <version>3.1.0</version>
                <scope>provided</scope>
            </dependency>
            <!--jsp-->
            <dependency>
                <groupId>javax.servlet.jsp</groupId>
                <artifactId>jsp-api</artifactId>
                <version>2.2</version>
                <scope>provided</scope>
            </dependency>
            <!--jstl-->
            <dependency>
                <groupId>jstl</groupId>
                <artifactId>jstl</artifactId>
                <version>1.2</version>
            </dependency>
            <dependency>
                <groupId>taglibs</groupId>
                <artifactId>standard</artifactId>
                <version>1.1.2</version>
            </dependency>
        </dependencies>
        ```
        
    - ç¼–å†™Servletç±»ï¼Œåç§°ä¸ºAServletï¼Œç”¨æ¥å‘é€Cookie
        
        ```java
        @WebServlet("/aServlet")
        public class AServlet extends HttpServlet {
            @Override
            protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
                //å‘é€Cookie
                //1. åˆ›å»ºCookieå¯¹è±¡
                Cookie cookie = new Cookie("username","zs");
                //2. å‘é€Cookieï¼Œresponse
                response.addCookie(cookie);
            }
        
            @Override
            protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
                this.doGet(request, response);
            }
        }
        ```
        
        æµ‹è¯•ï¼šæµè§ˆå™¨è®¿é—®`http://localhost:8080/cookie-demo/aServlet` ï¼Œä½¿ç”¨chromeæµè§ˆå™¨æŸ¥çœ‹Cookieçš„å€¼ï¼ˆä¸¤ç§æ–¹å¼ï¼‰
        
    - ç¼–å†™ä¸€ä¸ªæ–°Servletç±»ï¼Œåç§°ä¸ºBServletï¼Œç”¨æ¥è·å–Cookie
        
        ```java
        @WebServlet("/bServlet")
        public class BServlet extends HttpServlet {
            @Override
            protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
                //è·å–Cookie
                //1. è·å–Cookieæ•°ç»„
                Cookie[] cookies = request.getCookies();
                //2. éå†æ•°ç»„
                for (Cookie cookie : cookies) {
                    //3. è·å–æ•°æ®
                    String name = cookie.getName();
                    if("username".equals(name)){
                        String value = cookie.getValue();
                        System.out.println(name+":"+value);
                        break;
                    }
                }
        
            }
        
            @Override
            protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
                this.doGet(request, response);
            }
        }
        ```
        
        æµ‹è¯•ï¼šè®¿é—®`http://localhost:8080/cookie-demo/bServlet`
        
    
    <aside>
    â“ åœ¨è®¿é—®AServletå’ŒBServletçš„ä¸­é—´æŠŠå…³é—­æµè§ˆå™¨,é‡å¯æµè§ˆå™¨åè®¿é—®BServletèƒ½å¦è·å–åˆ°Cookieä¸­çš„æ•°æ®?
    
    </aside>
    

### 2.3 ****Cookieçš„åŸç†åˆ†æ****

- Cookieçš„å®ç°åŸç†æ˜¯åŸºäºHTTPåè®®çš„,å…¶ä¸­è®¾è®¡åˆ°HTTPåè®®ä¸­çš„ä¸¤ä¸ªè¯·æ±‚å¤´ä¿¡æ¯:
    - å“åº”å¤´:set-cookie
    - è¯·æ±‚å¤´: cookie
    
    ![Untitled](Cookie%20849cd773d5294afe9832d86d42307bca/Untitled%201.png)
    
- éªŒè¯
    - è®¿é—®AServletå¯¹åº”çš„åœ°å€`http://localhost:8080/cookie-demo/aServlet`
    - æ‰“å¼€å¼€å‘è€…å·¥å…·æŸ¥çœ‹å“åº”å¤´ä¸­çš„æ•°æ®
    - è®¿é—®BServletå¯¹åº”çš„åœ°å€`http://localhost:8080/cookie-demo/bServlet`
    - æ‰“å¼€å¼€å‘è€…å·¥å…·æŸ¥çœ‹è¯·æ±‚å¤´ä¸­çš„æ•°æ®

### 2.4 ****CookieæŒä¹…åŒ–å­˜å‚¨****

- Cookieçš„å­˜æ´»æ—¶é—´
    - é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookieå­˜å‚¨åœ¨æµè§ˆå™¨å†…å­˜ä¸­ï¼Œå½“æµè§ˆå™¨å…³é—­ï¼Œå†…å­˜é‡Šæ”¾ï¼Œåˆ™Cookieè¢«é”€æ¯
- CookieæŒä¹…åŒ–å­˜å‚¨
    - è®¾ç½®Cookieå­˜æ´»æ—¶é—´
        
        `setMaxAge(int seconds)`
        
        > å‚æ•°å€¼å–å€¼ï¼š
        > 
        > 
        > æ­£æ•°ï¼šå°†Cookieå†™å…¥æµè§ˆå™¨æ‰€åœ¨ç”µè„‘çš„ç¡¬ç›˜ï¼ŒæŒä¹…åŒ–å­˜å‚¨ã€‚åˆ°æ—¶é—´è‡ªåŠ¨åˆ é™¤
        > 
        > è´Ÿæ•°ï¼šé»˜è®¤å€¼ï¼ŒCookieåœ¨å½“å‰æµè§ˆå™¨å†…å­˜ä¸­ï¼Œå½“æµè§ˆå™¨å…³é—­ï¼Œåˆ™Cookieè¢«é”€æ¯
        > 
        > é›¶ï¼šåˆ é™¤å¯¹åº”Cookie
        > 
    - ä¾‹å¦‚ï¼Œåœ¨AServletä¸­å»è®¾ç½®Cookieçš„å­˜æ´»æ—¶é—´ä¸ºä¸€å‘¨ï¼š`cookie.setMaxAge(60*60*24*7);`

### 2.5 ****Cookieå­˜å‚¨ä¸­æ–‡****

- æ–¹æ¡ˆï¼šä½¿ç”¨URLç¼–ç å’Œè§£ç 
- æ¼”ç¤ºï¼šä¿®æ”¹Aservletå’ŒBservletä»£ç 
    - Aservletï¼Œè®¾ç½®URLç¼–ç 
    
    ```java
    @WebServlet("/aServlet")
    public class AServlet extends HttpServlet {
        @Override
        protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
            //å‘é€Cookie
            String value = "å¼ ä¸‰";
            //å¯¹ä¸­æ–‡è¿›è¡ŒURLç¼–ç 
            value = URLEncoder.encode(value, "UTF-8");
            System.out.println("å­˜å‚¨æ•°æ®ï¼š"+value);
            //å°†ç¼–ç åçš„å€¼å­˜å…¥Cookieä¸­
            Cookie cookie = new Cookie("username",value);
            //è®¾ç½®å­˜æ´»æ—¶é—´   ï¼Œ1å‘¨ 7å¤©
            cookie.setMaxAge(60*60*24*7);
            //2. å‘é€Cookieï¼Œresponse
            response.addCookie(cookie);
        }
    
        @Override
        protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
            this.doGet(request, response);
        }
    }
    ```
    
    - Bservletï¼Œè®¾ç½®URLè§£ç 
    
    ```java
    @WebServlet("/bServlet")
    public class BServlet extends HttpServlet {
        @Override
        protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
            //è·å–Cookie
            //1. è·å–Cookieæ•°ç»„
            Cookie[] cookies = request.getCookies();
            //2. éå†æ•°ç»„
            for (Cookie cookie : cookies) {
                //3. è·å–æ•°æ®
                String name = cookie.getName();
                if("username".equals(name)){
                    String value = cookie.getValue();//è·å–çš„æ˜¯URLç¼–ç åçš„å€¼ %E5%BC%A0%E4%B8%89
                    //URLè§£ç 
                    value = URLDecoder.decode(value,"UTF-8");
                    System.out.println(name+":"+value);//valueè§£ç åä¸º å¼ ä¸‰
                    break;
                }
            }
    
        }
    
        @Override
        protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
            this.doGet(request, response);
        }
    }
    ```